#‚öôÔ∏è 1. Principe g√©n√©ral du pr√©-filtrage
#HTML brut
#   ‚Üì
#Nettoyage (scripts, pubs, menus)
#   ‚Üì
#Segmentation en blocs (headings, sections, cartes)
#   ‚Üì
#Filtrage par crit√®res structurels (longueur, type, position, densit√© texte)
#   ‚Üì
#Classification heuristique (titre, mat√©riaux, outils, √©tapes, etc.)
#   ‚Üì
#Sortie filtr√©e (JSON interm√©diaire ou HTML simplifi√©)


#üß∞ 2. Outils de base
#a) Supprimer les balises inutiles

for tag in soup(["script", "style", "nav", "footer", "header", "iframe", "svg"]):
    tag.decompose()

#b) Segmenter par headings
def segment_by_headings(soup):
    sections = []
    current = {"title": "Introduction", "content": []}
    for elem in soup.find_all(["h1", "h2", "h3", "p", "ul", "ol", "img"]):
        if elem.name in ("h1", "h2", "h3"):
            sections.append(current)
            current = {"title": elem.get_text(" ", strip=True), "content": []}
        else:
            current["content"].append(elem)
    sections.append(current)
    return sections

#üîç 4. Exemple complet (extrait g√©n√©rique)

import re
from bs4 import BeautifulSoup

def clean_and_segment(html):
    soup = BeautifulSoup(html, "html.parser")

    # Supprimer scripts / styles / menus
    for tag in soup(["script", "style", "nav", "footer", "header", "iframe"]):
        tag.decompose()

    # Rassembler les sections
    sections = []
    current = {"title": "Introduction", "blocks": []}
    for elem in soup.find_all(["h1","h2","h3","p","ul","ol","img"]):
        if elem.name in ("h1","h2","h3"):
            sections.append(current)
            current = {"title": elem.get_text(" ", strip=True), "blocks": []}
        else:
            current["blocks"].append(elem)
    sections.append(current)

    # Heuristique simple : labellisation par titre
    for s in sections:
        title = s["title"].lower()
        if any(k in title for k in ["mat√©riaux","materials","supplies"]):
            s["label"] = "MATERIAUX"
        elif any(k in title for k in ["outils","tools","equipment"]):
            s["label"] = "OUTILS"
        elif any(k in title for k in ["√©tape","step"]):
            s["label"] = "ETAPES"
        elif any(k in title for k in ["mentions","license","licence"]):
            s["label"] = "MENTIONS"
        else:
            s["label"] = "INTRO"
    return sections


#üßÆ 5. Densit√© et scoring

def score_section(section):
    text = " ".join(b.get_text(" ", strip=True) for b in section["blocks"])
    n_chars = len(text)
    n_imgs = sum(1 for b in section["blocks"] if b.name == "img")
    density = n_chars / max(len(str(section)), 1)
    score = n_chars + 50 * n_imgs + 200 * density
    return score



